<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R For Agriculture - Ghana R Conference</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.25/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# R For Agriculture - Ghana R Conference
]
.subtitle[
## Kevin O’Brien - June 2024
]

---


### Kevin O'Brien

- Agricultural Data Scientist based in the West of Ireland 
  - Also in London, UK a lot

#### Previously
  
- Why R? - Community Team lead &amp; Webinars co-ordinator (on hiatus)

- Python Ireland - Director and Conference Lead

- JuliaCon 2018 to 2023 - Social Media Chair

- Was previously (what is now known) as a "Research Software Engineer" in a University.

---

![Limerick City](images/Limerick.jpg)
---

### Agriculture and Forestry


* R is very useful in Forestry 
 - Diameter at Breast Height / Height
 - Growth Curves and Yield Models
 - Statistical Analysis and Data Visualization
 
* Other R packages have been ***VERY*** useful 

![ForestryData](images\timbeter.png)













---

## Historical Context

* Statistical Methods to promote Human Development date all the way back to prehistorical times.

* Crops, Commerce, Lunar Cycles, Employment, Taxation etc

* Three short examples from ancient times - all from the African Continent

* Humankind will (hopefully) be doing the same sort of activities 1000s of years into the future.




---

### The Ishango Bone

&lt;img src="images/IshangoBone.PNG" alt="ishango" width="500"/&gt;



The Ishango bone, discovered at the "Fisherman Settlement" of Ishango in the Democratic Republic of the Congo, is believed to be an ancient mathematical device known as a "Tally Stick" that dates to the Upper Paleolithic era (20,000 years ago).

---

### Lebombo Stick

&lt;img src="images/LebomboStick.PNG" alt="Lebombo" width="750"/&gt;

(Source: HistoryOfInformation.com)

---

### Ancient Egyptians Attendance Record (Ostracon)

&lt;img src="images/Ostracon.PNG" alt="Ostracon" width="600"/&gt;

(Source: www.mymodernmet.com)

---

### Ancient Egyptians Attendance Record

(Text from *www.mymodernmet.com*)

***3,200-Year-Old Egyptian Tablet Shows They Took Attendance at Work and Recorded Absences***

Calling in sick to work is apparently an ancient tradition. Whether its the sniffles or a scorpion bite, somedays you just can't make it. As it turns out, Ancient Egyptian employers kept track of employee days off in registers written on tablets. A tablet held by The British Museum and dating to 1250 BCE is an incredible window into ancient work-life balance. The 40 employees listed are marked for each day they missed, with reasons ranging from illness to family obligations.

(Source: www.mymodernmet.com)


---














### Data Science Careers

![Career](images/MeetingsDocumentation.PNG)

&lt;br&gt;

---

### &lt;tt&gt;Tweet by @Type_Error&lt;/tt&gt;

![Career](images/Type_Error_1.PNG)

&lt;br&gt;



![Career](images/Type_Error_2.PNG)


---

### Domain Knowledge 

* Michael Green  (Data Scientist @ NIM)

Comments on LinkedIn

https://www.linkedin.com/feed/update/urn:li:activity:6765853465861267456/


---

### Importance of Domain Knowledge (1)

![Career](images/DomainKnowledge1.PNG)

&lt;br&gt;

(*screenshot of LinkedIn Post listed previously - Part 1*)


---

### Importance of Domain Knowledge (2)

![Career](images/DomainKnowledge2.PNG)

&lt;br&gt;
(*screenshot of LinkedIn Post listed previously  - Part 2*)

---

### Importance of Domain Knowledge (3)

![Career](images/DomainKnowledge3.PNG)


&lt;br&gt;
(*screenshot of LinkedIn Post listed previously - Part 3*)


---

### Stripe

![Stoxygen Factor](images/stripe_stoxygen.PNG)

---



### Career Strategy

Think about tedious boring jobs that can be automated, and processes that can be made more efficient

![Darkside](images/Darkside.jpg)






 

















---

## Harvesting Timber

**Harvester Head**

&lt;img src="images/HarvestorHead_1.PNG" alt="Harvest Timber 1" width="800"/&gt;


(Source: Discovery KAI's Youtube channel)

---

#### Harvesting Timber

**Felling**

&lt;img src="images/HarvestorHead_2.PNG" alt="Harvest Timber 2" width="800"/&gt;


(Source: Discovery KAI's Youtube channel)

---

#### Harvesting Timber

**Delimbing and Bucking**

&lt;img src="images/HarvestorHead_3.PNG" alt="Harvest Timber 3" width="800"/&gt;


(Source: Discovery KAI's Youtube channel)

---

#### Harvesting Timber

&lt;img src="images/HarvestorHead_4.PNG" alt="Harvest Timber 4" width="800"/&gt;


(Source: Discovery KAI's Youtube channel)


---

#### Harvesting Timber

&lt;img src="images/HarvestorHead_5.PNG" alt="Harvest Timber 5" width="800"/&gt;


(Source: Discovery KAI's Youtube channel)

---

### Raw Timber Data Collected

* **Logs** : Log Length, Diameters at each end, Volume, Product Type

* **Stems**: Diameter at Breast Height (DBH), Species of Tree, Location, Number of Products

* Number of logs and stems runs into millions.


### Additional Information Known

* **Locale**: Age and Species Mix of Plantation, Soil Composition and Elevation.

### Derived Information

* Impute the Top Height of the tree using Taper equations,

---

### U.S. Forest Service


&lt;img src="images/USForestService.PNG" alt="US Forest Service" width="800"/&gt;


(Website: www.fs.usda.gov)














---

## Using the Harvest Data

#### {dbplyr}

&lt;img src="images/dbplyr.PNG" alt="dbplyr" width="800"/&gt;


(Source: dbplyr.tidyverse.org)

---


&lt;img src="images/duckdb_dplyr.jpg" alt="duckplyr" width="750"/&gt;


(Source: https://duckdb.org/2024/04/02/duckplyr.html)

---

## duckdb

* The goal of ***duckplyr*** is to provide a drop-in replacement for ***dplyr*** that uses DuckDB as a backend for fast operation. DuckDB is an in-process SQL OLAP database management system.

* ***duckplyr*** also defines a set of generics that provide a low-level implementer’s interface for dplyr’s high-level user interface.

(Source: duckdblabs and posit documentation)

---

## duckdb &amp; duckplyr

&lt;img src="images/duckdb_R_API.png" alt="duckplyr" width="800"/&gt;

(Source: https://duckdb.org/docs/api/r.html)

---

## Task Scheduling

&lt;img src="images/TashScheduler.png" alt="Task Scheduler" width="800"/&gt;

---

## Batch Files

&lt;pre&gt;&lt;code&gt;

Rscript.exe "C:/Analysis/myRScripts.R"

&lt;/code&gt;&lt;/pre&gt;


### Resource:
* **https://www.r-bloggers.com/2023/06/how-to-use-a-windows-bat-file-to-execute-an-r-script/**













---

#### Statistical Process Control- Deming in Japan (1)

*Statistical Process Control is developed in the 1920’s by Walter Shewart at Bell Telephone Laboratories. It started as an investigation to develop a scientific basis for attaining economic control of quality of manufacturing product through the establishment of control limits to indicate at every stage in the production process from raw materials to finished product*

*Just prior to World War II American industrial management did not pay very much attention to Deming and his views on statistical techniques and open management style. However Japan’s post war efforts to increase production, and to compete with western industries, found Deming’s philosophy attractive.*



(source: https://datalyzer.com/lessons/where-did-statistical-process-control-spc-came-from/)

---

#### Deming in Japan (2)

*Top Japanese management concluded that they had to improve quality, and invited Deming to lecture in Japan in the early 1950’s. The successful tour lead to a few companies implementing the Deming methodologies and within a few months their quality and productivity increased.* 

*This in turn led to a greater proliferation of these techniques in Japan. It was the commitment of top Japanese management, the realization of the rewards of SPC implementation plus the philosophies of Deming that are the basis of Japanese competitive advantage as we know it today.* 

(source: https://datalyzer.com/lessons/where-did-statistical-process-control-spc-came-from/)

---

### {qcc} R package

{qcc} is a contributed R package for statistical quality control charts which provides:

* Shewhart quality control charts for continuous, attribute and count data
* Cusum and EWMA charts
* Operating characteristic curves
* Process capability analysis
* Pareto chart and cause-and-effect chart
* Multivariate control charts.

(source: https://luca-scr.github.io/qcc/articles/qcc.html )


---

### {qcc} R package

&lt;img src="images/xbarchart.PNG" alt="xbarchart" width="700"/&gt;

(source: https://luca-scr.github.io/qcc/articles/qcc.html )


---

## Decision Rules for Control Charts

Decision rules in statistical process control for detecting out-of-control or non-random conditions on control charts.

* Nelson Rules
* Western Electric Company (WECO) Rules
* Westgard Rules


---


#### Rule 2

* **Observe**: Nine (or more) points in a row are on the same side of the mean.
* **Conclusion**: Some prolonged bias exists.

&lt;img src="images/NelsonRule2.PNG" alt="NelsonRule2" width="500"/&gt;

---

### Conclusion

* Develop a suite of simple, well thought-out metrics and indicators that accurately describe the current state of a process.

* Make these metrics accessible to non-technical users.

---

---



---
















### Manipulation of Directories and File Permissions

These functions provide a low-level interface to the computer's file system.

#### Usage

* &lt;tt&gt; dir.exists(paths)&lt;/tt&gt;
* &lt;tt&gt; dir.create(path, showWarnings = TRUE, recursive = FALSE, mode = "0777")&lt;/tt&gt;

#### Others
* &lt;tt&gt; Sys.chmod(paths, mode = "0777", use_umask = TRUE)&lt;/tt&gt;
* &lt;tt&gt; Sys.umask(mode = NA)&lt;/tt&gt;

---

### File Manipulation

These functions provide a low-level interface to the computer's file system.

#### Usage

* &lt;tt&gt; file.exists(...) &lt;/tt&gt;
* &lt;tt&gt; file.remove(...) &lt;/tt&gt;
* &lt;tt&gt; file.rename(from, to) &lt;/tt&gt;

* &lt;tt&gt; file.copy(from, to, overwrite = recursive, recursive = FALSE,
          copy.mode = TRUE, copy.date = FALSE) &lt;/tt&gt;

#### Others

* &lt;tt&gt; file.append(file1, file2) &lt;/tt&gt;
* &lt;tt&gt; file.create(..., showWarnings = TRUE) &lt;/tt&gt;
* &lt;tt&gt; file.symlink(from, to) &lt;/tt&gt;
* &lt;tt&gt; file.link(from, to) &lt;/tt&gt;
* &lt;tt&gt; Sys.junction(from, to) &lt;/tt&gt;

---

### Rstats - What They Forget to Teach you.

![Rstats_WTF](images/rstats-wtf.PNG)


* ***www.rstats.wtf***
* The &lt;tt&gt; {here} &lt;/tt&gt; R package



---

















![excel](images/excel-globalfinancialsystem.PNG)

---


![excel](images/readxl.PNG)

(*** Source: readxl.tidyverse.org ***)

---


### Working with Documents

* Agriculture and Forestry is highly regulated in Ireland 
  - (Water quality, natural heritage, habitats)
* Lots of documents
* Government agencies strongly prefer Microsoft Word and PDFs
* Legal Documents
* Time consuming



---















### PDF Tools

![PDF Tools](images/pdftools.PNG)


(***Source: ROpenSci Organization***)
---

### Usage

&lt;pre&gt; &lt;code&gt;
pdf_info(pdf, opw = "", upw = "")

pdf_text(pdf, opw = "", upw = "")

pdf_data(pdf, font_info = FALSE, opw = "", upw = "")

pdf_fonts(pdf, opw = "", upw = "")

pdf_attachments(pdf, opw = "", upw = "")

pdf_toc(pdf, opw = "", upw = "")

pdf_pagesize(pdf, opw = "", upw = "")

&lt;/code&gt;&lt;/pre&gt;



---

### &lt;tt&gt;pdf_text()&lt;/tt&gt;

* Extract text from an inputed PDF document.
* Each line corresponds to a single string

&lt;pre&gt;&lt;code&gt;

myPDFText &lt;- pdf_text( myInputPDF )

&lt;/code&gt;&lt;/pre&gt;

#### Processing

* Very high accuracy for PDF documents that were created directly from MS Word. (i.e. Save as "PDF")
* Taking advantage of the standardized format of the documents, the contents can be processed and add to a single spreadsheet.


---

### &lt;tt&gt;pdf_combine()&lt;/tt&gt;

&lt;pre&gt;&lt;code&gt;

library(pdftools)

# Combine 2 two-page documents

pdf_combine(
  input = c("TESTPAGE1.pdf", "TESTPAGE2.pdf"), 
  output = "TESTCOMBINED.pdf")

# Should say 4
pdf_length("TESTCOMBINED.pdf")
&lt;/code&gt;&lt;/pre&gt;


---

### Tesseract

Useful for more complicated scans (photocopies)

![Tesseract](images/tesseract.PNG)

---

### magick R package

![magick](images/magickPackage.PNG)



#### The magick R package supports:

* Many common formats: png, jpeg, tiff, pdf, etc
* Different manipulations types: rotate, scale, crop, trim, flip, blur, etc.

---















![doconv](images/doconv-cran.PNG)

---


#### Package Author

* David Gohel (Ardata.Fr)
* Twitter : &lt;tt&gt;@DavidGohel&lt;/tt&gt;

#### doconv: Document Conversion to 'PDF' or 'PNG'

* Functions to convert 'Microsoft Word' or 'Microsoft PowerPoint' documents to 'PDF' format and also for converting them into a thumbnail. 

* In order to work, 'LibreOffice' must be installed on the machine and possibly 'python' and 'Microsoft Word'. 

* If the latter is available, it can be used to produce PDF documents identical to the originals, otherwise, 'LibreOffice' is used.




---


&lt;tt&gt;docx2pdf&lt;/tt&gt; Convert docx to pdf

#### Description

* Convert docx to pdf directly using "Microsoft Word". This function will not work if "Microsoft
Word" is not available on your machine.

* On Windows, this is implemented via win32com while on macOS this is implemented via JXA
(Javascript for Automation, aka AppleScript in JS).


#### Usage 

&lt;pre&gt;&lt;code&gt;
docx2pdf(input, output = gsub("\\.docx$", ".pdf", input))

&lt;/code&gt;&lt;/pre&gt;





---















### {Stringr} - Processing Text with R


![stringr](images/stringr.PNG)

(***Source: stringr.tidyverse.org***)

---

### Useful Base R commands


#### Text

* &lt;tt&gt; grep()&lt;/tt&gt;
* &lt;tt&gt; gsub()&lt;/tt&gt;
* &lt;tt&gt; nchar()&lt;/tt&gt;
* &lt;tt&gt; paste()&lt;/tt&gt;
* &lt;tt&gt; readLines() &lt;/tt&gt; and &lt;tt&gt;writeLines()&lt;/tt&gt;
* &lt;tt&gt; matrix() &lt;/tt&gt;

#### Dates

* &lt;tt&gt; Sys.Date()&lt;/tt&gt;
* &lt;tt&gt; as.Date()&lt;/tt&gt;

---

#### &lt;tt&gt;matrix()&lt;/tt&gt;


```r
colours()[1:16]
```

```
##  [1] "white"         "aliceblue"     "antiquewhite"  "antiquewhite1"
##  [5] "antiquewhite2" "antiquewhite3" "antiquewhite4" "aquamarine"   
##  [9] "aquamarine1"   "aquamarine2"   "aquamarine3"   "aquamarine4"  
## [13] "azure"         "azure1"        "azure2"        "azure3"
```


```r
matrix(colours()[1:16],nrow=4,byrow=TRUE)
```

```
##      [,1]            [,2]            [,3]            [,4]           
## [1,] "white"         "aliceblue"     "antiquewhite"  "antiquewhite1"
## [2,] "antiquewhite2" "antiquewhite3" "antiquewhite4" "aquamarine"   
## [3,] "aquamarine1"   "aquamarine2"   "aquamarine3"   "aquamarine4"  
## [4,] "azure"         "azure1"        "azure2"        "azure3"
```

---

### {lubridate} - Working with dates with R


![lubridate](images/lubridate.PNG)

(***Source: lubdridate.tidyverse.org***)
---

### Officerverse

* David Gohel

* https://www.ardata.fr/
* davidgohel.github.io

#### R Packages

* Officer 
* Flextable 
* Officedown

---

















### Officer R Package

Automated Generation of Word Documents with R

![officer](images/officer-r-package.PNG)


---

### Officer R Package

#### Examples

&lt;pre&gt;&lt;code&gt;
my_doc &lt;- read_docx() %&gt;%
      body_add_par(value='Some text etc etc') %&gt;%
      body_add_flextable(value=ft) %&gt;% 
      body_add_break()
      
&lt;/code&gt;&lt;/pre&gt;      

* Formatted Text

* Add Images

* Replace Text in Existing Document


---

### Officer R Package

#### Example

&lt;pre&gt;&lt;code&gt;

MyText_header &lt;- fpar(ftext(MyText_header ,  
		prop = fp_text(color = "black", font.family="Calibri", 
		font.size = 14, bold = TRUE)))

MyText_1 &lt;- fpar(ftext(MyText_1 ,  
		prop = fp_text(color = "black", font.family="Calibri", 
		font.size = 12, bold = FALSE)))

MyText_2  &lt;- fpar(ftext(MyText_2 ,  
		prop = fp_text(color = "black", font.family="Calibri", 
		font.size = 12, bold = FALSE)))

&lt;/code&gt;&lt;/pre&gt;

---

### Officer R Package

#### Example

&lt;pre&gt;&lt;code&gt;
my_doc &lt;- my_doc  %&gt;% 
  body_add_fpar( MyText_header ) %&gt;%   
  body_add_par("", style = "Normal") %&gt;%
  body_add_fpar( MyText_1 ) %&gt;%   
  body_add_par("", style = "Normal") %&gt;%
  body_add_fpar( MyText_2) %&gt;%   
  body_add_par("", style = "Normal")


print(my_doc, target = Output_File_Name)
&lt;/code&gt;&lt;/pre&gt;



---
















### Flextable R Package

Automated Generation of Tables with R

![flextable](images/flextable-r-package.PNG)

(***Author: David Gohel***)
---

### Flextable R Package

Automated Generation of Tables with R

![flextable](images/flextable-r-package-2.PNG)

(***Author: David Gohel***)

---

### Flextable R Package

&lt;pre&gt;&lt;code&gt;
This_OutPut_Table  &lt;- This_Input_DF %&gt;% 
  flextable() %&gt;% 
  width(width=c(2.25,4.75)) %&gt;%  
  align( align = "left", part = "all" ) %&gt;%
  font(fontname = "Calibri",part="all") %&gt;%
  fontsize(size = 12, part = "body") %&gt;%
  padding(padding = 3, part = "all" ) %&gt;%
  delete_part(part="header") %&gt;%
  border_remove() %&gt;%
  border_outer( part="all", border = big_border ) %&gt;%
  border_inner_h(part="all", border = big_border ) %&gt;%
  border_inner_v(part="all", border = big_border ) 


my_doc &lt;- my_doc %&gt;% 
  body_add_flextable(This_OutPut_Table,align="left") %&gt;%
  body_add_par("", style = "Normal")

&lt;/code&gt;&lt;/pre&gt;

---

### Flextable Gallery

&lt;tt&gt; ardata-fr.github.io/flextable-gallery/gallery/ &lt;/tt&gt;

![flextable](images/gallery.PNG)

(***Author: David Gohel***)


---

### Useful R packages

* &lt;tt&gt; {tidyverse} &lt;/tt&gt;
* &lt;tt&gt; {janitor} &lt;/tt&gt;
* &lt;tt&gt; {scales} &lt;/tt&gt;

### Useful Commands

* &lt;tt&gt; sprintf() &lt;/tt&gt;




---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
